<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FilmyFly4Wap YouTube Player</title>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="referrer" content="no-referrer">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/controls.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/shaka-player.ui.min.js"></script>

<style>
  * {margin:0;padding:0;box-sizing:border-box;}
  html,body{
    width:100%;height:100%;
    background:#000;
    font-family:'Roboto',sans-serif;
    display:flex;justify-content:center;align-items:center;
  }
  .video-container{
    width:100%;height:100%;
    position:relative;overflow:hidden;
    background:#000;
  }
  video{width:100%;height:100%;background:#000;}
  #myLogo{
    position:absolute;top:12px;right:15px;
    width:90px;opacity:0.85;
    z-index:100;pointer-events:none;
  }
  #loading{
    position:absolute;top:50%;left:50%;
    transform:translate(-50%,-50%);
    color:#fff;font-size:18px;text-align:center;
    z-index:20;
  }
  #error{
    position:absolute;bottom:25px;left:50%;
    transform:translateX(-50%);
    background:rgba(255,0,0,0.7);
    color:#fff;padding:8px 14px;border-radius:6px;
    font-size:14px;display:none;
  }

  /* --- YouTube Theme --- */
  .youtube-theme .shaka-played-range{background:#ff0000!important;}
  .youtube-theme .shaka-buffered-range{background:rgba(255,255,255,.4)!important;}
  .youtube-theme .shaka-seek-bar{background:rgba(255,255,255,.2)!important;}
  .youtube-theme .shaka-bottom-controls{
    background:rgba(0,0,0,0.6)!important;
    height:56px;padding:0 8px;
  }
  .youtube-theme .shaka-controls-button-panel>*{
    color:#fff;height:56px;
  }
  .youtube-theme .shaka-overflow-menu,
  .youtube-theme .shaka-settings-menu{
    background:rgba(30,30,30,.95)!important;
    border-radius:4px;
  }
  .youtube-theme .shaka-controls-container{
    bottom:0!important;
  }
</style>
</head>

<body>
<div class="video-container youtube-theme">
  <img id="myLogo" src="https://filmyfly4wap.github.io/Logo/filmyfly4wap.png" alt="FilmyFly4Wap">
  <div id="loading">Loading stream... ⏳</div>
  <div id="error">⚠️ Stream currently unavailable.</div>
  <div class="shaka-video-container" data-shaka-player>
    <video id="video" autoplay playsinline muted></video>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const urlParams = new URLSearchParams(window.location.search);
  const streamUrl = urlParams.get('url');
  const video = document.getElementById('video');
  const loading = document.getElementById('loading');
  const errorBox = document.getElementById('error');

  if (!streamUrl) {
    errorBox.innerText = '⚠️ Stream URL missing!';
    errorBox.style.display = 'block';
    loading.style.display = 'none';
    return;
  }

  try {
    const player = new shaka.Player(video);
    const ui = new shaka.ui.Overlay(player, document.querySelector('.shaka-video-container'), video);

    ui.configure({
      'controlPanelElements': [
        'play_pause','mute','time_and_duration','spacer',
        'rewind','fast_forward','quality','language','captions',
        'picture_in_picture','fullscreen','overflow_menu'
      ],
      'seekBarColors': {
        base:'rgba(255,255,255,.2)',
        buffered:'rgba(255,255,255,.4)',
        played:'rgb(255,0,0)'
      }
    });

    player.configure({
      streaming:{bufferingGoal:10,rebufferingGoal:2},
      manifest:{retryParameters:{timeout:30000,maxAttempts:2,baseDelay:1000}}
    });

    console.log('Loading stream:', streamUrl);
    await player.load(streamUrl);
    loading.style.display='none';
    console.log('✅ Stream loaded successfully');

    // Force autoplay
    try { await video.play(); } 
    catch { video.muted=true; await video.play(); }

    // Auto quality (Adaptive) + Manual available
    player.configure({abr:{enabled:true}});

    player.addEventListener('error', e=>{
      console.error('Stream Error:', e.detail);
      errorBox.style.display='block';
    });

  } catch(err){
    console.error('Init error:', err);
    errorBox.style.display='block';
    loading.style.display='none';
    video.src=streamUrl; // fallback
    try{ await video.play(); }catch{}
  }
});
</script>
</body>
</html>
